{% load templatetag_handlebars %}
{% load i18n %}
{% load static %}


{% tplhandlebars "current_order" %}

    <div class="container section">

        <!-- donation -->
        <header class="wrapper">
            <h1 class="main-title">Support one or more projects!</h1>
        </header>

    </div>

    <div class="container">

        <section class="wrapper">

        <ul class="donation-steps">
            {{#view App.OrderNavView classNames="support"}}
                {{#linkTo currentOrderItemList}}Support{{/linkTo}}
            {{/view}}
            {{#view App.OrderNavView classNames="details"}}
                {{#linkTo paymentOrderProfile}}{% trans "Details" %}{{/linkTo}}
            {{/view}}
            {{#view App.OrderNavView classNames="profile"}}
                <a>{% trans "Profile" %}</a>
            {{/view}}

            {{#view App.OrderNavView classNames="payment"}}
                {{#linkTo currentPaymentMethodInfo}}{% trans "Pay" %}{{/linkTo}}
            {{/view}}
        </ul>

            {{outlet}}

            <!--
            <div class="sidebar tip">
              <h3>Did you know?</h3>
              <p>Fusce quam enim, vehicula euismod porttitor vitae, facilisis a purus. Maecenas augue metus, consectetur eleifend posuere in, rhoncus ac enim.</p>
              <p><a href="#">Read some more</a></p>
            </div>
            -->

        </section>

    </div>

{% endtplhandlebars %}


{% tplhandlebars "currentorderitem_form" %}

    <fieldset>

        <ul id="donation-projects">
            {{#each controller}}
                {{view "App.CurrentOrderItemView" content=this}}
            {{else}}
                {{#linkTo projectList}}
                    <h1>{% trans "Choose a project to make a donation" %}</h1>
                    <b>{% trans "Select a project from the list and click 'Support this project' to add it to this list." %}</b>
                {{/linkTo}}
            {{/each}}
        </ul>

        {{#linkTo projectList class="add-project"}}{%trans "Add another project" %}{{/linkTo}}

    </fieldset>

    <fieldset class="donation-frequency">
        <label class="label">{% trans "Support the selected projects:" %}</label>
        {{#view Em.RadioButtonGroup name="frequency" selectedValueBinding="view.parentView.controller.content.recurring"}}
            <label>
                {{view view.RadioButton value="false"}}
                {% trans "Single donation" %}
            </label>
            <br/>
            <label>
                {{view view.RadioButton value="true"}}
                {% trans "Monthly donation" %}
            </label>
        {{/view}}
        {# Doesnt update <span class="currency"><em>&euro; </em>{{view.parentView.controller.content.amount}}</span> #}

    </fieldset>

{{#linkTo paymentOrderProfile class="button right"}}{% trans "Next step" %}{{/linkTo}}

{% endtplhandlebars %}


{% tplhandlebars "payment_order_profile" %}
    <fieldset>
        {{#if content.isLoaded}}
            {{#each errors.first_name}}<span class="error">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="firstName" placeholder="First name" classBinding="errors.first_name.length:error"}}

            {{#each errors.last_name}}<span class="errors">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="lastName" placeholder="Last name" classBinding="errors.last_name.length:error"}}

            {{#each errors.email}}<span class="errors">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="email" placeholder="Email" classBinding="errors.email.length:error"}}

            {{#each errors.street}}<span class="errors">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="street" placeholder="Street + housenumber" classBinding="errors.street.length:error"}}

            {{#each errors.postal_code}}<span class="errors">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="postalCode" placeholder="Postal code" classBinding="errors.postal_code.length:error"}}

            {{#each errors.city}}<span class="errors">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="city" placeholder="City" classBinding="errors.city.length:error"}}

            {{#each errors.country}}<span class="errors">{{this}}</span>{{/each}}
            {{view App.CountrySelect valueBinding="country" classBinding="errors.country.length:error"}}

            <button class="right">{% trans 'Next step' %}</button>
        {{/if}}
    </fieldset>
{% endtplhandlebars %}


<!-- wrapper tag: <li class="donation-project"> -->
{% tplhandlebars "currentorderitem" %}

    {{#linkTo project project}}
        <img {{bindAttr src="project.image_square" alt="project.title"}} class="project-image" />
        <h1>{{project.title}} <em class="country">{{project.country.name}}</em></h1>
    {{/linkTo}}
    <p class="donation-amount">
        <strong class="amount-needed">&euro; {{view.neededAfterDonation}} {% trans "is still needed"%}</strong>
        <label for="donation-amount-1">{% trans "I'd like to give" %}</label>
        <span class="currency"><em>&euro; </em><input type="number" id="donation-amount-1" name="donation-amount-1" size="8" maxlength="4" {{bindAttr value="amount"}} /></span>
    </p>

    <a class="remove" {{action "delete" this target="view" }}>{% trans "Remove" %}</a>

{% endtplhandlebars %}


{% tplhandlebars "order_payment" %}

    <div class="intro">
        <h4>{% trans "YOU MAKE IT WORK!" %}</h4>
        {% trans "Choose the payment method you prefer to donate." %}
    </div>
    {{content.amount}}
    <fieldset>
        <div class="tabs vertical">
            {{#view Em.RadioButtonGroup name="payment_method" selectedValueBinding="view.parentView.controller.content.payment_method_id"}}
                {{#each view.parentView.parentView.controller.content.payment_methods}}
                    <label class="tab">
                        {{view view.RadioButton value=this.id}}
                        {{this.name}}
                    </label>
                {{else}}
                    {% trans "No payment methods available" %}
                {{/each}}
            {{/view}}
        </div>
        <div class="panes vertical">
            {{outlet}}
        </div>
    </fieldset>

{% endtplhandlebars %}


{% tplhandlebars "payment_method_info" %}

    <fieldset>
        {{#if content.isLoaded}}
            {{#if view.parentView.parentView.controller.isIdeal}}
                {{view App.IdealPaymentMethodInfoView}}
            {{else}}
                {{#if view.parentView.parentView.controller.isDirectDebit}}
                    {{view App.DirectDebitPaymentMethodInfoView}}
                {{else}}
                    {{#if payment_url}}
                        <a {{bindAttr href="payment_url"}} class="button right">{% trans "Pay" %}</a>
                    {{else}}
                        <button class="button right">{% trans "Next" %}</button>
                    {{/if}}
                {{/if}}
            {{/if}}

        {{else}}
            <img src="{% get_static_prefix %}images/loading.gif" height="16px" /> {% trans "loading information..." %}
        {{/if}}
    </fieldset>

{% endtplhandlebars %}


{% tplhandlebars "ideal_payment_method_info" %}

    <fieldset>
        {{#if content.isLoaded}}
            {{view Em.Select contentBinding="App.bankList"
                             optionValuePath="content.value"
                             optionLabelPath="content.title"
                             valueBinding="view.parentView.parentView.parentView.controller.content.payment_submethod_id"}}
            {{#if payment_url}}
                <a {{bindAttr href="payment_url"}} class="button right">{% trans "Pay" %}</a>
            {{else}}
                <button>{% trans "Next" %}</button>
            {{/if}}
        {{else}}
            <img src="{% get_static_prefix %}images/loading.gif" height="16px" /> {% trans "loading information..." %}
        {{/if}}
    </fieldset>

{% endtplhandlebars %}


{% tplhandlebars "direct_debit_payment_method_info" %}

    <fieldset>
        {{#if content.isLoaded}}
            {{#each errors.bank_account_number}}<span class="error">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="bank_account_number" placeholder="Bank account number" classBinding="errors.bank_account_number.length:error"}}

            {{#each errors.bank_account_name}}<span class="error">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="bank_account_name" placeholder="Bank account holder name" classBinding="errors.bank_account_name.length:error"}}

            {{#each errors.bank_account_city}}<span class="error">{{this}}</span>{{/each}}
            {{view Em.TextField valueBinding="bank_account_city" placeholder="Bank account city" classBinding="errors.bank_account_city.length:error"}}

            <button>{% trans "Next" %}</button>
        {{else}}
            <img src="{% get_static_prefix %}images/loading.gif" height="16px" /> {% trans "loading information..." %}
        {{/if}}
    </fieldset>

{% endtplhandlebars %}


{% tplhandlebars "final_order_item_list" %}

    <div class="container section">
        <header class="wrapper">
            <h1 class="main-title">{% trans "Thank you!" %}</h1>
        </header>

    </div>

    <div class="container">

        <section class="wrapper">
            <form>
            <ul id="donation-projects">
                {{#each orderitem in controller}}
                    <li class="donation-project">
                        {{#linkTo project orderitem.project}}
                            <img {{bindAttr src="orderitem.project.image_square"}} class="project-image" alt="Project Name" />
                        {{/linkTo}}
                        <h1>
                            {{#linkTo project orderitem.project}}
                                {{orderitem.project.title}}
                            {{/linkTo}}
                            <em class="country">{{orderitem.project.country.name}}</em>
                        </h1>
                        <p class="donation-amount">
                            <label for="donation-amount-1">{% trans "You just donated" %}</label>
                            <span class="big currency">&euro; {{orderitem.amount}}</span>
                        </p>
                    </li>

                {{/each}}

            </ul>
            </form>
        </section>
    </div>
{% endtplhandlebars %}
